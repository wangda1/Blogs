# 深度学习环境的部署

## 1. CUDA 环境的配置

refer: https://www.cnblogs.com/yhjoker/p/10972795.html

- 如何更改 `cuda` 版本

先来看下 pytorch 如何找到 cuda（以下过程为顺序进行，满足条件即停止）

1. 先查看环境变量 `CUDA_HOME` 或 `CUDA_PATH`
2. 检查系统固定路径 `/usr/local/cuda`，寻找该软链接文件
3. `which nvcc` 查看 `nvcc` 所在的 cuda 安装目录，并将其作为运行时的 cuda 版本

通过以上可以确定更改 `cuda` 的方法：

1. 对于非 `root` 账户，可以使用环境变量的方法：指定 `CUDA_HOME` 与 `PATH`
2. 对于 `root` 账户，可以在 `/usr/local/cuda` 修改该软链接文件

- 如何查看 `cuda` 及 `cudnn` 版本

```python
>>> import torch
>>> torch.version.cuda   # 该命令查看的是编译 pytorch 使用的 cuda 版本，并不一定是运行的时候的版本
```

```python
>>> import torch
>>> import torch.utils
>>> import torch.utils.cpp_extension
>>> torch.utils.cpp_extension.CUDA_HOME # 此为查看运行时的 cuda 版本的方法
```

或者通过查看 `/usr/local/cuda` 目录：

```shell
# cuda 版本
cat /usr/local/cuda/version.txt
# cudnn 版本
cat /usr/local/cuda/include/cudnn.h | grep CUDNN_MAJOR -A 2
nvcc --version
```

## 2. pytorch 中查看GPU信息

```python
# cuda 是否可用
torch.cuda.is_available()
# 返回 GPU 数量
torch.cuda.device_count()
# 返回 GPu 的名字，设备索引默认从 0 开始
torch.cuda.get_device_name(0)
# 返回当前设备索引
torch.cuda.current_device()
# 返回 torch 的版本
torch.version()
# 返回 cuda 的版本
torch.version.cuda()
```

## 3. tensorflow 环境配置

### 3.1 安装 tensorflow-gpu

```python
# 安装 GPU 版本的 tensorflow
pip install tensorflow-gpu
# 安装 CPU 版本的 tensorflow
pip install tensorflow
```

**注意： tensorflow的安装版本应该参考官方发布，与 cuda 的版本保持一致**

### 3.2 安装参考

- `tensorflow:` https://www.tensorflow.org/install#requirements_to_run_tensorflow_with_gpu_support
- `CUDA:` https://developer.nvidia.com/cuda-toolkit-archive

